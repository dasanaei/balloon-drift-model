                     Global Reference Atmospheric Model (GRAM)
                              Code Change History


 Version   Date   References and Features
 -------   -----  -----------------------------------------------------------
  GRAM     1974   NASA TMX 64871 & 64872.  Global coverage, but with 6-month
                  displacement of northern hemisphere middle atmosphere to
                  represent southern hemisphere.  Speigler & Fowler four-
                  dimensional (4-D) database for lower atmosphere.  Jacchia
                  model thermosphere. Single-scale perturbation model.
                  Geostrophic wind approximation for winds at all levels.

  MOD 2    1976   Final Report MSFC Contract NAS8-30657. Two-scale random
                  perturbation model.  Buell constraints on perturbation
                  values. Revised quasi-biennial oscillation values.  Second-
                  order geostrophic winds near equator.

  MOD 3    1980   NASA CR 3256. Spherical harmonic model represents observed
                  rocketsonde winds in middle atmosphere.

 GRAM-86   1986   Final Report USRA Project P5042-0A0 (MSFC Prime NAS8-
                  36400/1).  Revised middle atmospheric perturbation
                  statistics.

 GRAM-88   1988   NASA Special Report ES44-11-9-88.  Revised atmospheric
                  perturbation statistics.  Correct various problems
                  reported in lower altitude (4-D) data base.

 GRAM-90   4/91   NASA TM 4268.  New middle atmosphere data bases for means
                  and perturbation statistics, based on Middle Atmosphere
                  Program (MAP) data.  Observed winds global database for
                  middle atmosphere.  Jacchia thermospheric model replaced
                  by similar Marshall Engineering Thermosphere (MET) model.

 GRAM-95   8/95   NASA TM 4715.  Global Upper Air Climatic Atlas (GUACA)
                  database for global coverage of lower atmosphere,
                  including observed wind climatology.  Atmospheric species
                  concentration output.  Variable-scale small-scale
                  perturbation model.

 GRAM-95   5/96   Patch to apply rpscale factor to GUACA data.  Patch for
                  year 2000+ correction (except for year 2000 being leap
                  year).

 GRAM-95  10/96   Develop changes necessary for PC (MS FORTRAN Powerstation)
                  version.

 GRAM-95  12/97   Patch for year 2000+ compatibility including year 2000
                  being leap year.

 GRAM-97   6/97   Contains initial versions of new features for GRAM-99.
 (beta)           Details of the small-scale perturbations differ from
	 	  GRAM-98 beta and GRAM-99 official release.

 GRAM-98   3/98   Contains almost all the features described for GRAM-99.
 (beta)           Very minor differences in the thermosphere (MET) region
                  from the GRAM-99 official release.  Details of the new
                  large-scale wave model are different from the GRAM-99
                  official release.  Four digit year input option not
                  available (Y2K compatible for 1957-2056 only).  Time step
                  and Taylor's hypothesis not included in correlations for
                  small-scale perturbations. Includes option for using GRAM
                  climatology instead of fixed boundary value for MET
                  (option not included in final GRAM-99 release).

 GRAM-99  5/99    NASA/TM-1999-209630. Optional Range Reference Atmosphere
                  data for mean atmospheres near launch sites.  Optional
                  Global Gridded Upper Air Statistics (GGUAS) ASCII data
                  for lower atmosphere.  Wave model for large-scale
                  perturbations.  Option for user-selected initial
                  perturbations.  Complete Year 2000+ compatibility,
                  including option for four digit year input.  NAMELIST
                  input format.  Revised details of variable-scale, small-
                  scale perturbation model.  Includes revised Marshall
                  Engineering Thermosphere 1999 version (MET-99).  Time
                  step and Taylor's hypothesis included in correlations
                  for small-scale perturbations.
                  
 GRAM-99  8/00    Add new input parameter patchy, to allow suppression of 
 (Ver 2)          patchiness in perturbation model.  Correct calculations 
                  that allow wind perturbation sigmas to exceed values in 
                  Figure 2 of TM 4168.  Correct calculations that allow 
                  large changes in severe turbulence perturbations relative 
                  to normal (non-severe) sigmas

 GRAM-99  8/05    Special NASA Langley edition with option to update mean
 (Ver 3  Beta     atmosphere without updating perturbations.
 
 GRAM-99  10/06   Updates described, and example results given in file
 (Ver 3)          GRAMfixVer3.doc.  Other than some "cosmetic" changes,
                  all updates affect only the perturbations, not the 
                  mean values of total standard deviations.

 GRAM-2007 1/07   Incorporates option to use revised Range Reference 
 (beta)           Atmosphere (RRA) data, developed by Air Force Combat 
                  Climatology Center (AFCCC) in 2006.  Option is also 
                  retained to use previous (1983) RRA data.  In addition to 
                  RRA option, an "auxiliary profile" feature has been
                  implemented.  This allows the user to input a data profile
                  of pressure, density, temperature, and/or winds versus
                  altitude, with the auxiliary profile values used in place
                  of conventional climatology (GUACA/MAP/etc.) values.
                  Includes several updates to Marshall Engineering 
                  Thermosphere (MET) model, now denoted MET-2007. MET 
                  updates include:
                    (1) corrections for inconsistency between constituent
                    number density and mass density [described by Justus, 
                    C. G., Aleta Duvall, and Vernon W. Keller, "Earth Global 
                    Reference Atmospheric Model (GRAM-99) and Trace Consti-
                    tuents", Paper C4.1-0002-04, Presented at 35th COSPAR 
                    Scientific Assembly Paris, France July 18-25, 2004].
                    (2) Representation of gravity above oblate spheroid,
                    rather than spherical Earth approximation.
                    (3) Treatment of day-of-year as continuous variable in
                    semi-annual term, rather than as integer day.
                    (4) Treatment of year as either 365 or 366 days in
                    lengths (as appropriate), rather than all years having
                    length = 365.2422 days.
                    (5) Allows continuous variation of time input, rather
                    than limiting time increments to integer minutes.
                    (6) Additional output from MET07_TME subroutine of 
                    Modified Julian Day, right ascension of Sun, and right 
                    ascension at local lat-lon (used for input to new JB2006 
                    thermosphere model)
                  As an alternate to MET, an option is now available to use
                  the Naval Research Labs Mass Spectrometer, Incoherent 
                  Scatter Radar Extended Model for the thermosphere 
                  (NRL MSIS E-00).  If the MSIS model option is used, the NRL
                  Harmonic Wind Model (HWM 93) is used to compute 
                  thermospheric winds. The Jacchia-Bowman 2006 (JB2006)
                  thermosphere model has also been added as a third option
                  to compute thermosphere values.  References to developmental
                  papers for JB2006 are given in the code (JB2006_E07.f) and at
                  the JB2006 web site http://sol.spacenvironment.net/~JB2006/.
                  Starting point for the GRAM implementation of JB2006 is
                  their REV-A October, 2006.  Changes made, mostly cosmetic
                  and to make the code more transportable among various
                  compilers, are described in file JB2006fix.txt.  If JB2006
                  is selected for calculation of thermospheric density and
                  temperature, winds are computed with the Harmonic Wind 
                  Model (HWM 93), used in conjunction with the MSIS model.
                  Earth radii for reference ellipsoid have been updated to 
                  World Geodetic System (WGS 84) values, used by the GPS 
                  navigation system.  Input values of altitude greater than 
                  6000 km are treated as geocentric radius values, rather than 
                  heights.  Both radius and height are now given on the output 
                  file.  Although all input latitudes are geocentric, GRAM now 
                  outputs both geocentric and geodetic values.  Several changes
                  or additions have been made in the GRAM perturbation model.  
                  These include:
                    (1) New feature to update atmospheric mean values
                    without updating perturbation values.
                    (2) Ability to simulate large-scale, partially-correlated
                    perturbations as they progress over times for a few hours
                    to a few days.
                    (3) Revisions to correlations scales for time-correlation
                    (4) Random variation of vertical and horizontal scales
                    for large-scale perturbations
                    (5) A multiple-trajectory driver routine (multtraj), that
                    allows multiple trajectories and perturbations to be 
                    simulated in one GRAM run.
                  To create unique program element names, "_E07" has been
                  appended to names of all program files, subroutines, 
                  functions, and common blocks.  All code lines have been 
                  re-numbered.  Added subroutine radll to compute horizontal
                  distance from great-circle distance between two input lat-
                  lon positions.  Added new subroutine CaltoJul for conversion
                  from calendar date to Julian day.
                  
 Earth-GRAM       Correct initialization of rpscale.  Adjust vertical scale of
 2007(beta) 4/07  small-scale perturbations for better comparison with KSC
                  wind shears.

 Earth-GRAM
 2007      10/07  Correct roundoff problem in radll_E07 function, affecting 
                  some compilers, especially UNIX and Linux. Correct problem 
                  with initialization of small-scale perturbations in corrtraj 
                  driver routine.  Correct problem with truncation of wind 
                  perturbations at high altitudes (above about 90 km).  
                  Corrects problem with standard deviations at altitudes
                  below surface at Range Reference Atmosphere sites. Adds more 
                  information on runtime prompts from corrtraj GRAM driver 
                  program. Added random variation in amplitude of large-scale, 
                  wave perturbations.  Changed some values of large-scale 
                  fraction, used to partition total observed variance into 
                  large-scale and small-scale variances.  These changes 
                  increase the frequency of occurrence of perturbations 
                  exceeding +/- 3 standard deviations, to better match 
                  expectations for Normal distribution.  Corrected problem 
                  with time step and height step when reading positions from 
                  trajectory input file. Corrected UNIX overflow problem in
                  MET07 subroutine.

Earth-GRAM 2007
Ver-1.1 4/08      Add new multbody_E07.f main driver illustrating how to call 
                  GRAM to evaluate perturbations along trajectories of multiple 
                  bodies which start out together and at various times separate 
                  from each other. The perturbations for each body start out 
                  the same, and then remain correlated over both position and 
                  time along the body trajectories, and across the spatial 
                  separation between the bodies. Fixed problem with standard
                  deviations being updated when perturbation pdate option is 
                  off (ipdate < 0).  Corrected name of subroutine 
                  GeodettoGeocent_E07.  Add test in radll function to make it 
                  more "bullet-proof". Change condition when sea level is 
                  reached and max number of points has not been reached from
                  a terminal error condition to a status message and continue.

Earth-GRAM 2007
Ver-1.2 7/08      Bug-fix to correct (PC-Windows) effect of round-off error 
                  whereby radll routine gave slightly non-zero (~ 1E-6 km) value 
                  of dx for identical input lat-lons. This problem affected 
                  initial small-scale perturbation values (and all subsequent 
                  values, because of stepwise correlation effect), but did not 
                  affect overall statistics (standard deviations, rms shears, 
                  etc.) from small-scale perturbations.  Bug-fix to correct 
                  (Unix/Linux) round-off errors whereby GeocenttoGeodet routine 
                  gave incorrect results for latitudes within about 0.02 degrees 
                  of the poles (but not at the poles).  Revised model for 
                  vertical winds in boundary layer (BL, assumed to be surface to 
                  1.5 km above surface).  New BL model requires input of revised
                  "atmosdat" file atmosdat_E07.txt, which contains surface type
                  (water or 12 types of land surface, including ice).  Surface
                  roughness (z0) is determined by land type, or a wind-dependent
                  z0 for water.  Optionally, z0 can be provided by user input,
                  from the NameList input file.  Above BL, sigma-w is interpolated 
                  to first level (5 or 10 km) above top of BL.  Output of sigma-w,
                  land surface code (LC), and surface roughness (z0) added to
                  "Special-formatted" output file. [See README7.txt for details
                  of new vertical wind model]
                  
Earth-GRAM 2007
Ver-1.3 3/09      Change details for computation of initial perturbations, to make
                  the methodology more consistent with that used to compute 
                  subsequent perturbations.  Revise details of adjustment of
                  temperature perturbations, to take into account cross-correlation
                  of pressure and density perturbations.  Revise fractions of
                  total temperature and density variance made up from large-scale 
                  density and temperature perturbations.  Bug fixes for the various
                  sample trajectory codes, especially corrtraj.
                  
Earth-GRAM 2007
Ver-1.4 4/09      Fix RRA bug at line RRAM144a (change z1 to z2).  Added lines 
                  GRMT132a and 132b in gramtraj_E07.

Earth-GRAM 2007
Ver-1.4 7/09      Fix inconsistency between MSIS and HWM, whereby AP is treated as
                  array indexed 2 in one and indexed 7 in the other.  This may
                  affect recompiles, with Intel compiler only. 

Earth-GRAM
2010 Beta 04/09  Converted code to Fortran 90 and double precision.  Converted all 
                 common blocks to modules, with consistent variable names. Added 
                 interface modules.  Changed identifiers on subroutines, functions, 
                 etc. from _E07 to _E10.  Replaced GUACA or GGUAS climatologies 
                 with monthly global climatology (means and standard deviations) 
                 from National Centers for Environmental Prediction (NCEP) 
                 Reanalysis Project.  Default NCEP period of record is 1990-
                 2008.  NCEP climatology includes means and standard 
                 deviations for four times of day.  This option is selected by 
                 using input NCEPyr=9008 and NCEPhr= 1 for 00UT, 2 for 06UT, 
                 3 for 12UT, 4 for 18UT, or 5 for total daily statistics.  See 
                 file README4.txt for details of the NCEP data and how to use 
                 it.  Re-compute large-scale pressure perturbation to insure 
                 better than 1st order correspondence to perfect gas law, 
                 also making perturbed sound speed calculated from 
                 Sqrt(gamma*R*T) agree with perturbed sound speed computed from
                 Sqrt(gamma*p/rho).  Added mean sound speed and perturbed sound 
                 speed to "print format" and "special format" output files.  
                 Add option to input standard deviations (sigmas) in auxiliary 
                 profiles (new subroutine ProfSigs).  If zero values are 
                 entered for sigmas in the auxiliary profile, sigmas are taken 
                 from conventional climatology (NCEP/MAP data).  An exception 
                 to this is for isolated zero values for sigmas, which are set 
                 the same as the previous (non-zero) sigma values from the 
                 file.  Warning messages are written if input sigmas exceed 
                 30% of the mean value, and standard deviations are limited 
                 to 30% of the mean (so 3-sigma will not exceed +/- 90% of the 
                 mean value).  Added new input scaling parameter (ruscale and 
                 rwscale) for horizontal and vertical wind perturbations (input
                 parameter rpscale now applies only to density, temperature, 
                 and pressure perturbations).  Deleted option to use 1983 Range 
                 Reference Atmosphere (RRA) sites, allowing only new (2006) RRAs.  
                 New input parameter (rralist), providing file name for list of 
                 available sites.  Different RRA sites or combinations of 
                 sites can be made available by building various RRA lists, 
                 and the RRA set to use controlled at run time.  Revised use
                 of Elliott-Gaffen moisture corrections, to take advantage of
                 all moisture variables being available in Earth-GRAM version
                 of NCEP data.  Revise calculation of standard deviation of
                 relative humidity (RH), to account for correlation between 
                 vapor pressure and saturation vapor pressure (correlation 
                 evaluated empirically from study of NCEP RH data).  Changed
                 fairing between GUACA and MAP data (over 20-27 km) to apply
                 to NCEP/MAP fairing over 24-27 km.  Used global climatology 
                 of chemical release winds to revise U and V wind perturbation 
                 standard deviations (codes RU and RV) in the 90-120 km 
                 altitude range of the atmosdat file (Miguel Larsen, J. 
                 Geophys. Res., Vol. 107, NO. A8, 1215, 2002).  Added output
                 of wind speed means and standard deviations, and cross
                 correlation between Eastward and Northward wind components
                 (Ruv).  Ruv is used to compute the wave-like large-scale 
                 northward wind perturbation in such a way as to produce the 
                 appropriate degree of cross-correlation. Added effects of
                 time-of-day and atmospheric stability on boundary layer height
                 and vertical wind standard deviations in the boundary layer
                 (see file VerticalWindModel.pdf). Revised details of method
                 to partition total variances of pressure, density and temperature
                 into large-scale and small-scale components.  The new method
                 assumes the same fraction for all three variables and assumes
                 the pressure-density correlation is the same for small-scale,
                 large-scale, and total perturbations.  This method removes the
                 need for re-scaling the large-scale and small-scale perturbations,
                 computed from the first-order gas law.  To keep realistic
                 vertical scales for pressure perturbations, their effective 
                 correlation scale is increased to 10 times that for density and
                 temperature (with factor plf). Remove initial random pressure
                 perturbation (rpinit) from input - compute rpinit from rdinit and
                 rtinit, by 1st-order gas law. Replaced JB2006 thermosphere model 
                 with new JB2008.

Earth-GRAM
2010 Beta2 06/09 Changes for gfortran compiler.  NCEP binaries now in more current
                 "standard" format for unformatted files. Changed NCEP subroutines
                 to interpolate first on altitude, then on lat-lon (instead of
                 vice-versa). Changed fairing region for NCEP data, from fixed
                 altitudes hg1=24 km and hg2=27 km, to local heights determined 
                 from 20 mb and 10 mb levels [hg1 = Max(z20) and hg2 = Min(z10)].
                 
Earth-GRAM
2010 Beta2 07/09 Changed method to partition total variances of pressure, density 
                 and temperature into large-scale and small-scale components, back
                 to the method previously used. Changed plf factor back to 3.0. 

Earth-GRAM
2010 Beta2 01/10 Added _E10 suffixes to all subroutine and function names in the 
                 three thermosphere models MET, MSIS, HWM, and JB2008. Added _E10
                 suffixes to all Common blocks in MSIS and HWM code.
                 
Earth-GRAM
2010Ver1.0 05/10 Official release of Earth-GRAM 2010 Version 1.0

Earth-GRAM
2010Ver1.0 07/10 Change flat to phi at line JACM104.  Added EOF and error check
                 messages for Namelist input file.
                 
Earth-GRAM       
2010V2.0   04/11 Adjust pressure-density cross correlation (rpd) as necessary, to
                 insure that density-temperature correlation (rdt) is appropriately
                 negative, and a function of altitude.  Change the upper limit on 
                 large-scale pressure variance fraction (rpdl) from 0.95 to 0.99.
                 Add correct transfer of standard deviation variables to the rramods 
                 subroutine, and from the profsigs subroutine, called in subroutine 
                 randinit. Revise method for computing initial small-scale pressure 
                 perturbation in randinit, to insure appropriate correlation with 
                 small-scale density perturbation.

Earth-GRAM
2010V3.0   03/12 Created input parameter iyrrra to provide the option to use either 
		 2006 or 1983 RRA database sites.
                 

Earth-GRAM
2010V4.0   02/14 Provides input option iyrrra = 3 to select the 2013 RRA database for 
		 CCAFS, FL, EAFB, CA, Vandenberg AFB, CA, and White Sands Missile Range, NM 
		 sites.


Earth-GRAM
2016	   12/16 Code re-written in C++, object-oriented programming language.  Updated
		 NCEP period of record to 1997 to 2015.  New inpute variable 'mc' for
                 entering number of Monte Carlo runs.